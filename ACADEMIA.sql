--ATIVIDADE AVALIATIVA N1
--ALUNOS: MATEUS HENRIQUE BELTRAME E NICOLAS EDUARDO
--TURMA A


CREATE DATABASE ACADEMIA;

------- CRIAÇÃO DAS TABELAS E COLUNAS

CREATE TABLE PLANOS(
	PLANO NVARCHAR(15),
	VALOR MONEY,
)

CREATE TABLE UNIDADE(
	UNIDADE NVARCHAR(90),
	QUANTIDADE_ALUNOS INT,
	MEDIA_ALUNOS_DIA INT,
	FATURAMENTO_UNIDADE MONEY,
)

CREATE TABLE ALUNOS(
	NOME_DO_ALUNO NVARCHAR(80),
	DATA_NASCIMENTO DATE,
	BAIRRO NVARCHAR(50),
	STATUS_PAGAMENTO BIT, -- 1 PARA PAGO E 0 PARA INADINPLENTE
	PLANO NVARCHAR(15),
	UNIDADE NVARCHAR(90), --EM QUAL UNIDADE DA ACADEMIA VOCE TREINA SE É NA DO BARRIO TAL AO NA DO CENTRO
	INICIO_CADASTRO DATE, --QUANDO INICIOU NA ACADEMIA
)

CREATE TABLE BAIRROS (
	NOME_DO_BAIRRO NVARCHAR(80),
	TOTAL_ALUNOS INT,
)

CREATE TABLE CHECK_INS_UNIDADE_CENTRO(
	NOME_DO_ALUNO NVARCHAR(80),
	DATA_HORA_ENTRADA DATETIME,
)

CREATE TABLE CHECK_INS_UNIDADE_ZONASUL(
	NOME_DO_ALUNO NVARCHAR(80),
	DATA_HORA_ENTRADA DATETIME,
)

CREATE TABLE PRODUTOS(
	NOME_PRODUTO NVARCHAR(40),
	CATEGORIA NVARCHAR(40),
	PRECO MONEY,
	QUANTIDADE_EM_ESTOQUE INT,
)

CREATE TABLE COMPRAS(
	NOME_DO_ALUNO NVARCHAR(80),
	PRODUTO NVARCHAR(40),
	VALOR MONEY,
	DATA_COMPRA DATE,
)

CREATE TABLE RELATORIOS( --RELATORIOS DE TODAS AS UNIDADES NO MES
	LUCRO_COMPRAS MONEY,
	TOTAL_ALUNOS INT,
	TOTAL_DE_CHECK_INS INT,
	DATA_RELATORIO DATE,
)

------- SELECIONA AS TABELAS E MOSTRA AS INFORMAÇÕES

SELECT * FROM PLANOS;
SELECT * FROM UNIDADE;
SELECT * FROM ALUNOS;
SELECT * FROM BAIRROS;
SELECT * FROM CHECK_INS_UNIDADE_CENTRO;
SELECT * FROM CHECK_INS_UNIDADE_ZONASUL;
SELECT * FROM PRODUTOS;
SELECT * FROM COMPRAS;
SELECT * FROM RELATORIOS;

------- INSERINDO INFORMAÇÕES NAS TABELAS

INSERT INTO PLANOS (PLANO, VALOR)VALUES
('FITNESS', '99.00'),
('POWER', '139.00'),
('ULTIMATE', '159,00')

ALTER TABLE UNIDADE ADD MES NVARCHAR(10)

INSERT INTO UNIDADE (UNIDADE, QUANTIDADE_ALUNOS,MEDIA_ALUNOS_DIA,FATURAMENTO_UNIDADE, MES)VALUES
('UNIDADE CENTRO', '850', '320', '145000.00', 'JANEIRO'),
('UNIDADE ZONA SUL', '620', '210', '110000.00', 'JANEIRO')

INSERT INTO ALUNOS (NOME_DO_ALUNO, DATA_NASCIMENTO, BAIRRO, STATUS_PAGAMENTO, PLANO, UNIDADE, INICIO_CADASTRO)VALUES
('MARCOS SOUZA', '1995-04-12', 'CENTRO', '1', 'PLANO POWER', 'UNIDADE CENTRO', '2024-02-10'),
('JULIANA FERREIRA', '1988-09-25', 'ZONA SUL', '0', 'PLANO ULTIMATE', 'UNIDADE ZONA SUL', '2023-11-15'),
('ANA LIMA', '1993-03-30', 'CENTRO', '1', 'PLANO ULTIMATE', 'UNIDADE CENTRO', '2023-12-05'),
('RODRIGO ALMEIDA', '1997-06-18', 'ZONA SUL', '0', 'PLANO POWER', 'UNIDADE ZONA SUL', '2024-02-28'),
('LUCAS MARTINS', '1990-05-14', 'JARDINS', '1', 'PLANO POWER', 'UNIDADE CENTRO', '2024-01-10'),
('PATRICIA RIBEIRO', '1985-12-03', 'VILA NOVA', '0', 'PLANO ULTIMATE', 'UNIDADE ZONA SUL', '2023-10-22'),
('GUSTAVO SANTOS', '1999-08-27', 'ALTO DA SERRA', '1', 'PLANO FITNESS', 'UNIDADE ZONA SUL', '2024-02-15'),
('ISABELA MORAES', '1992-11-19', 'CENTRO', '1', 'PLANO ULTIMATE', 'UNIDADE CENTRO', '2023-09-30'),
('RAFAEL TEIXEIRA', '1996-07-07', 'SANTA CRUZ', '0', 'PLANO POWER', 'UNIDADE ZONA SUL', '2024-03-01'),
('MIRELA SOUZA', '2003-02-14', 'VILA OLÍMPIA', '1', 'PLANO FITNESS', 'UNIDADE ZONA SUL', '2024-01-25'),
('FÁBIO LIMA', '1987-06-29', 'CENTRO', '1', 'PLANO POWER', 'UNIDADE CENTRO', '2024-02-08')

INSERT INTO BAIRROS (NOME_DO_BAIRRO, TOTAL_ALUNOS)VALUES
('CENTRO', '4'),
('ZONA SUL', '2'),
('JARDINS', '1'),
('VILA NOVA', '1'),
('ALTO DA SERRA', '1'),
('SANTA CRUZ', '1'),
('VILA OLÍMPIA', '1')


INSERT INTO CHECK_INS_UNIDADE_CENTRO (NOME_DO_ALUNO, DATA_HORA_ENTRADA) VALUES
('MARCOS SOUZA', '2024-19-03 07:52:37'),
('ANA LIMA', '2024-19-03 09:13:45'),
('FÁBIO LIMA', '2024-19-03 08:42:59'),
('LUCAS MARTINS', '2024-20-03 07:07:21'),
('ISABELA MORAES', '2024-20-03 12:08:34'),
('ANA LIMA', '2024-21-03 09:48:15'),
('FÁBIO LIMA', '2024-21-03 08:23:10'),
('MARCOS SOUZA', '2024-22-03 07:31:50'),
('ANA LIMA', '2024-22-03 14:38:65'),
('LUCAS MARTINS', '2024-22-03 06:57:42'),
('MARCOS SOUZA', '2024-22-03 07:52:37'),
('ISABELA MORAES', '2024-23-03 12:32:18');

INSERT INTO CHECK_INS_UNIDADE_ZONASUL(NOME_DO_ALUNO, DATA_HORA_ENTRADA)VALUES
('JULIANA FERREIRA', '2024-19-03 08:04:22'),
('RODRIGO ALMEIDA', '2024-19-03 10:14:33'),
('GUSTAVO SANTOS', '2024-20-03 07:19:56'),
('RAFAEL TEIXEIRA', '2024-20-03 13:33:27'),
('MIRELA SOUZA', '2024-20-03 15:23:43'),
('PATRICIA RIBEIRO', '2024-21-03 11:48:39'),
('RODRIGO ALMEIDA', '2024-21-03 10:32:12'),
('GUSTAVO SANTOS', '2024-22-03 07:11:47'),
('RAFAEL TEIXEIRA', '2024-22-03 13:58:23'),
('MIRELA SOUZA', '2024-23-03 15:42:15');

-- Inserção dos produtos
INSERT INTO PRODUTOS (NOME_PRODUTO, CATEGORIA, PRECO, QUANTIDADE_EM_ESTOQUE)
VALUES
('TÊNIS ESPORTIVO', 'CALÇADOS', '249.99', '50'),
('CAMISETA FITNESS', 'ROUPAS', '79.90', '120'),
('CAFEÍNA EM COMPRIMIDO', 'SUPLEMENTOS', '79.90', '30'),
('MOCHILA DE TREINAMENTO', 'ACESSÓRIOS', '129.00', '60'),
('SUPLEMENTO WHEY', 'SUPLEMENTOS', '159.90', '40'),
('BONÉ ESPORTIVO', 'ACESSÓRIOS', '49.90', '200'),
('SHORTS DE CORRIDA', 'ROUPAS', '89.90', '80');

INSERT INTO COMPRAS (NOME_DO_ALUNO, PRODUTO, VALOR, DATA_COMPRA) VALUES
('MARCOS SOUZA', 'TÊNIS ESPORTIVO', '249.99', '2025-03-05'),
('RAFAEL TEIXEIRA', 'CAMISETA FITNESS', '79.90', '2025-03-10'),
('LUCAS MARTINS', 'HALTERES 5KG', '99.90', '2025-03-15'),
('RAFAEL TEIXEIRA', 'BONÉ ESPORTIVO', '49.90', '2025-03-15'),
('RODRIGO ALMEIDA', 'MOCHILA DE TREINAMENTO', '129.00', '2025-03-17'),
('ANA LIMA', 'SUPLEMENTO WHEY', '159.90', '2025-03-18'),
('GUSTAVO SANTOS', 'BONÉ ESPORTIVO', '49.90', '2025-03-19'),
('FÁBIO LIMA', 'SHORTS DE CORRIDA', '89.90', '2025-03-20'),
('RAFAEL TEIXEIRA', 'SHORTS DE CORRIDA', '89.90', '2025-03-20'),
('MARCOS SOUZA', 'SUPLEMENTO WHEY', '159.90', '2025-03-20');

-------

------- SOMAS DE VALOR GANHO COM AS COMPRAS DOS ALUNOS E A QAUNTIDADE DE ALUNOS

SELECT SUM(VALOR) FROM COMPRAS
SELECT SUM(QUANTIDADE_ALUNOS) FROM UNIDADE

------- UTILIZAÇÃO DO COUNT PARA SOMAR A QUANTIDADE DE ELEMENTOS EM UMA COLUNA
------- TRAMOIA DE UM SUB SELECT PRA NÃO PRECISAR FAZER 2 LINHAS DE PESQUISA DA QUANTIDADE DE ALUNOS QUE FEZ CHEK-INS
SELECT COUNT (NOME_DO_ALUNO) AS ZONASUL, (SELECT ( COUNT (NOME_DO_ALUNO)) FROM CHECK_INS_UNIDADE_CENTRO) AS CENTRO FROM CHECK_INS_UNIDADE_ZONASUL


------- CONTA QUANTAS VEZES O ALUNO ENTROU NA ACADEMIA NO MES 3 E ORGANIZA DO MAIOR PARA O MENOR, (NA UNIDADE DO CENTRO, E NA ZONASUL)
SELECT COUNT (NOME_DO_ALUNO) AS QUANTIDADE, NOME_DO_ALUNO FROM CHECK_INS_UNIDADE_CENTRO 
WHERE MONTH(DATA_HORA_ENTRADA) = 3
GROUP BY NOME_DO_ALUNO
ORDER BY QUANTIDADE DESC

SELECT COUNT (NOME_DO_ALUNO) AS QUANTIDADE, NOME_DO_ALUNO FROM CHECK_INS_UNIDADE_ZONASUL 
WHERE MONTH(DATA_HORA_ENTRADA) = 3
GROUP BY NOME_DO_ALUNO
ORDER BY QUANTIDADE DESC

------- VE QUAL É O BAIRRO MAIS CADATRADO
SELECT COUNT (BAIRRO) AS QUANTIDADE, BAIRRO FROM ALUNOS
GROUP BY BAIRRO
ORDER BY QUANTIDADE DESC

------- FAZ A MÉDIA DAS IDADES -- PEGA A DATA ATUAL - AS DATA DE NASCIMENTO DOS ALUNOS -- E USA O AVG PARA FAZER A MÉDIA
SELECT AVG(YEAR(GETDATE()) - YEAR(DATA_NASCIMENTO)) AS MEDIA_IDADE FROM ALUNOS;

------- FAZ A MÉDIA DO MES DE ANIVERSARIO
SELECT AVG(MONTH(DATA_NASCIMENTO)) AS MEDIA_ANIVERSARIO FROM ALUNOS

------- ALUNO QUE MAIS COMPROU
SELECT COUNT (NOME_DO_ALUNO) AS QUANTIDADE, NOME_DO_ALUNO FROM COMPRAS
GROUP BY NOME_DO_ALUNO
ORDER BY QUANTIDADE DESC

------- ALUNO QUE MAIS GASTOU
SELECT NOME_DO_ALUNO, SUM(VALOR) AS TOTAL_GASTO FROM COMPRAS
GROUP BY NOME_DO_ALUNO
ORDER BY TOTAL_GASTO DESC

------- ADICIONANDO MAIS COLUNAS A TABELA RELATORIOS

ALTER TABLE RELATORIOS ADD ALUNO_EXEMPLAR NVARCHAR(80)
ALTER TABLE RELATORIOS ADD BAIRRO_MAIS_CADASTRADO NVARCHAR(80)
ALTER TABLE RELATORIOS ADD MEDIA_ANIVERSARIO DECIMAL(2, 0)
ALTER TABLE RELATORIOS ADD MEDIA_IDADE DECIMAL(2, 0)
ALTER TABLE RELATORIOS ADD ALUNO_MAIS_COMPROU NVARCHAR(80)
ALTER TABLE RELATORIOS ADD ALUNO_MAIS_GASTOU NVARCHAR(80)

SELECT * FROM RELATORIOS;

------- INSERÇÃO DOS DADOS NA TABELA RELATORIOS

INSERT INTO RELATORIOS (LUCRO_COMPRAS, TOTAL_ALUNOS, TOTAL_DE_CHECK_INS, ALUNO_EXEMPLAR, BAIRRO_MAIS_CADASTRADO, MEDIA_ANIVERSARIO, MEDIA_IDADE, ALUNO_MAIS_COMPROU, ALUNO_MAIS_GASTOU, DATA_RELATORIO) VALUES
('1158.19', '1470', '20', 'MARCOS SOUZA', 'CENTRO', '06', '31', 'RAFAEL TEIXEIRA', 'MARCOS SOUZA', '2025-03-30')

------- PESQUISA STATUS DE PAGAMENTO 1 PARA PAGO E 0 PARA INADINPLENTE

SELECT * FROM ALUNOS WHERE STATUS_PAGAMENTO = 1;
SELECT * FROM ALUNOS WHERE STATUS_PAGAMENTO = 0;